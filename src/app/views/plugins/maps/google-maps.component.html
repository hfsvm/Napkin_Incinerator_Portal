<div class="refresh-circle">
  <span class="time">{{ formattedRefreshTime }}</span>
</div>
  
<div class="container-fluid ultra-advanced-map-ui">
  <div *ngIf="errorMessage" class="alert alert-danger text-center">
    {{ errorMessage }}
  </div>
  
  <div class="row">
    <div class="col-lg-3 col-md-4 col-sm-12 filter-column">
      <div class="filter-container p-3 shadow-lg rounded bg-white">
        <h4 class="text-center">
          <i class="fas fa-filter"></i> Smart Filters
          <button class="btn btn-sm btn-light float-right" (click)="toggleFilterPanel()">
            <i class="fas" [ngClass]="{'fa-chevron-down': !filterPanelOpen, 'fa-chevron-up': filterPanelOpen}"></i>
          </button>
        </h4>

        <div *ngIf="filterPanelOpen">
          <form>
            <div class="card-body">
              <div class="container">
      
                <!-- Display each filter in its own row -->
                <div *ngFor="let filter of [
                  { name: 'Client Name', key: 'projects', selected: selectedProjects, options: projects },
                  { name: 'Machine Status', key: 'machineStatuses', selected: selectedMachineStatuses, options: machineStatuses },
                  { name: 'Stock Status', key: 'stockStatuses', selected: selectedStockStatuses, options: stockStatuses },
                  { name: 'Burn Status', key: 'burnStatuses', selected: selectedBurnStatuses, options: burnStatuses },
                  { name: 'State', key: 'zones', selected: selectedZones, options: zones },
                  { name: 'District', key: 'wards', selected: selectedWards, options: wards },
                  { name: 'Zone', key: 'selectedSubZones', selected: selectedSubZones, options: subZones },
                  { name: 'Ward', key: 'selectedWardList', selected: selectedWardList, options: wardList },
                  { name: 'Beat', key: 'selectedBeatList', selected: selectedBeatList, options: beatList },
                  { name: 'Machines', key: 'beats', selected: selectedBeats, options: beats },
                ]" class="row filter mb-3">
                  <div class="col-12">
                    <ng-container *ngTemplateOutlet="dropdownTemplate; context: { $implicit: filter }"></ng-container>
                  </div>
                </div>
      
                <!-- Refresh Button -->
                <div class="row">
                  <div class="col-12 text-center mt-3">
                    <button class="btn btn-danger w-100" (click)="refreshFilters()">
                      üîÑ Refresh
                    </button>
                  </div>
                </div>
      
              </div>
            </div>
      
            <!-- Dropdown Template -->
            <ng-template #dropdownTemplate let-filter>
              <label>{{ filter.name }}</label>
              <div class="dropdown">
                <button class="btn btn-light dropdown-toggle w-100" type="button" (click)="toggleDropdown(filter.key)">
                  {{ filter.selected.length ? 'Selected (' + filter.selected.length + ')' : filter.name }}
                </button>
                <div class="dropdown-menu show" *ngIf="dropdownOpen[filter.key]" [id]="'dropdown-' + filter.key">
                  <div *ngIf="['beats', 'wards', 'zones', 'projects'].includes(filter.key)" style="padding: 6px;">
                    <input type="text" class="form-control" placeholder="Search..." 
                           [(ngModel)]="searchText[filter.key]" 
                           [ngModelOptions]="{standalone: true}"
                           (click)="$event.stopPropagation()" />
                  </div>
                  <label class="dropdown-item d-flex align-items-center" style="gap: 6px;">
                    <input type="checkbox" [checked]="filter.selected.length === filter.options.length && filter.options.length > 0"
                           (change)="toggleSelectAll(filter.selected, filter.options, filter.key)">
                    <strong style="margin: 0;">Select All</strong>
                  </label>
                  <label *ngFor="let option of filter.options | filterDropdown: searchText[filter.key]" class="dropdown-item">
                    <input type="checkbox" [checked]="filter.selected.includes(option.ProjectId || option.key || option)" 
                           (change)="toggleSelection(filter.selected, option.ProjectId || option.key || option, filter.key)">
                    {{ option.projectname || option.value || option }}
                  </label>
                </div>
              </div>
            </ng-template>
          </form>
          
        </div>
      </div>
    </div>

    <div class="col-lg-9 col-md-8 col-sm-12 map-column">
      <div class="map-container shadow-lg rounded">
        <div id="map" style="width: 100%; height: 650px;"></div>

         
  <div class="zoom-controls">
    <button (click)="zoomIn()">Ôºã</button>
    <button (click)="zoomOut()">Ôºç</button>

      </div>
    </div>
  </div>
  </div> 